<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ panel_name }}{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: { 900: '#0f0f23', 800: '#1a1a2e', 700: '#252542', 600: '#2d2d4a' },
                        accent: { 500: '#6366f1', 600: '#4f46e5', 400: '#818cf8' }
                    }
                }
            }
        }
    </script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    
    <!-- xterm.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    
    <!-- Monaco Editor -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
    
    <style>
        body { background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #0f0f23 100%); }
        .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
        .glass-strong { background: rgba(255,255,255,0.08); backdrop-filter: blur(30px); border: 1px solid rgba(255,255,255,0.15); }
        .glow { box-shadow: 0 0 30px rgba(99,102,241,0.3); }
        .sidebar-item { transition: all 0.2s ease; }
        .sidebar-item:hover { background: rgba(99,102,241,0.2); transform: translateX(4px); }
        .sidebar-item.active { background: rgba(99,102,241,0.3); border-left: 3px solid #6366f1; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .btn-primary { background: linear-gradient(135deg, #6366f1, #4f46e5); transition: all 0.2s; }
        .btn-primary:hover { transform: scale(1.02); box-shadow: 0 5px 20px rgba(99,102,241,0.4); }
        .fade-in { animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(99,102,241,0.5); border-radius: 4px; }
    </style>
    {% block head %}{% endblock %}
</head>
<body class="min-h-screen text-gray-100">
    {% if current_user.is_authenticated %}
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside class="w-64 glass-strong flex flex-col fixed h-full z-50">
            <div class="p-6 border-b border-white/10">
                <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                    {{ panel_name }}
                </h1>
                <p class="text-xs text-gray-500 mt-1">v{{ panel_version }}</p>
            </div>
            
            <nav class="flex-1 p-4 space-y-2">
                <a href="{{ url_for('dashboard.index') }}" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-xl {% if request.endpoint == 'dashboard.index' %}active{% endif %}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                    <span>Дашборд</span>
                </a>
                
                <a href="{{ url_for('docker.store') }}" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-xl {% if 'docker' in request.endpoint %}active{% endif %}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg>
                    <span>Docker Store</span>
                </a>
                
                <a href="{{ url_for('docker.containers') }}" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-xl">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    <span>Контейнеры</span>
                </a>
                
                <a href="{{ url_for('websites.index') }}" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-xl {% if 'websites' in request.endpoint %}active{% endif %}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path></svg>
                    <span>Сайты</span>
                </a>
                
                <a href="{{ url_for('files.manager') }}" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-xl {% if 'files' in request.endpoint %}active{% endif %}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>
                    <span>Файлы</span>
                </a>
                
                <a href="{{ url_for('terminal.index') }}" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-xl {% if 'terminal' in request.endpoint %}active{% endif %}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    <span>Терминал</span>
                </a>
            </nav>
            
            <div class="p-4 border-t border-white/10">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center font-bold">
                        {{ current_user.username[0].upper() }}
                    </div>
                    <div>
                        <p class="font-medium">{{ current_user.username }}</p>
                        <p class="text-xs text-gray-400">{% if current_user.is_admin %}Администратор{% else %}Пользователь{% endif %}</p>
                    </div>
                </div>
                <a href="{{ url_for('auth.logout') }}" class="flex items-center gap-2 text-red-400 hover:text-red-300 text-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    Выйти
                </a>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1 ml-64 p-8">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                    <div class="mb-4 p-4 rounded-xl glass fade-in {% if category == 'danger' %}border-red-500/50 bg-red-500/10{% elif category == 'success' %}border-green-500/50 bg-green-500/10{% else %}border-indigo-500/50 bg-indigo-500/10{% endif %}">
                        {{ message }}
                    </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            {% block content %}{% endblock %}
        </main>
    </div>
    {% else %}
        {% block auth_content %}{% endblock %}
    {% endif %}
    
    <script>
        // Common utilities
        const API = {
            async get(url) {
                const res = await fetch(url);
                return res.json();
            },
            async post(url, data) {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return res.json();
            },
            async delete(url) {
                const res = await fetch(url, { method: 'DELETE' });
                return res.json();
            }
        };
        
        function showToast(message, type = 'info') {
            const colors = { success: 'bg-green-500', error: 'bg-red-500', info: 'bg-indigo-500' };
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-xl shadow-lg fade-in z-50`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
